<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
<title>用户认证系统</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link th:href="@{css/main.css}" rel="stylesheet"></link>
<link th:href="@{/jquery-easyui-1.5.3/themes/material/easyui.css}"
	rel="stylesheet"></link>
<link th:href="@{/jquery-easyui-1.5.3/themes/icon.css}" rel="stylesheet"></link>

<script th:src="@{/jquery-easyui-1.5.3/jquery.min.js}"
	type="text/javascript"></script>
<script th:src="@{/jquery-easyui-1.5.3/easyloader.js}"
	type="text/javascript"></script>
<script th:src="@{/jquery-easyui-1.5.3/jquery.easyui.min.js}"
	type="text/javascript"></script>
<script th:src="@{/jquery-easyui-1.5.3/locale/easyui-lang-zh_CN.js}"
	type="text/javascript"></script>
<script th:src="@{/js/main.js}" type="text/javascript"></script>
</head>

<body class="easyui-layout" fit="true" style="text-align: left">
	<div data-options="region:'north',border:false" class="top-panel">
		<div class="xjtlu">&nbsp;</div>
		<div class="banner">用户认证系统</div>
		<div class="right-button-panel">
			<input type="hidden" id="userId" th:value="${currentUser.userId}" />
			<input type="hidden" id="userName" th:value="${currentUser.userName}" />
			<a class="easyui-linkbutton" data-options="plain:true" href="#"
				onclick="changePsd($('#userId').val(), $('#userName').val());">修改密码</a>
			<a class="easyui-linkbutton" data-options="plain:true"
				th:href="@{/logout}">退出系统</a>
		</div>
		<div class="user-panel" style="float: right;margin-left: 10px;margin-top: 40px;">
			<div class="user">
				欢迎 <span th:text="${currentUser.nickName}"></span>
			</div>
			<div class="agent" th:if="${previousUser}">
				<small><a style="color: #A52A2A;" class="easyui-linkbutton"
					plain="true" href="#" onclick="switchBack()">返回代理人<strong
						th:utext="${previousUser.nickName}" class="text-primary"
						style="padding-left: 4px; padding-right: 4px;"></strong>的身份
				</a></small>
			</div>
		</div>

		<div class="menu-combo">
			<label>系统菜单：</label> <select id="menuCombobox"
				class="easyui-combotree" style="width: 160px;">
			</select>
		</div>
	</div>
	<!-- <div data-options="region:'west',split:true,title:'菜单'"
		style="width: 180px; min-width: 180px;">
		<div>
			<ul id="menuTree" class="easyui-tree"></ul>
		</div>
	</div> -->
	<div data-options="region:'south',border:false"
		style="height: 20px; padding: 5px;">state panel</div>
	<div id="workspace" data-options="region:'center'" class="easyui-tabs">
		<div title="首页" style="padding: 5px; height: auto">
			<h1 class="text-primary">Welcome，<label th:text="${currentUser.nickName}"></label></h1>
		</div>
	</div>

	<!-- 修改密码窗体 -->
	<div id="changePasswordDlg" class="easyui-dialog" title="修改密码"
		style="width: 400px; height: auto;" closed="true"
		buttons="#changePasswordDlgButtons" data-options="modal:true">
		<form id="changePasswordForm" method="post">
			<div>
				<input name="userName" class="easyui-textbox" iconWidth="28"
					style="width: 100%; height: 34px; backgroud: gray" readonly="true"
					disabled="true" label="用户名称" labelWidth="60px" />
			</div>
			<div>
				<input id="pass" name="newPassword" class="easyui-passwordbox"
					prompt="请输入新的登录密码" iconWidth="28" required="true"
					style="width: 100%; height: 34px;" label="新密码" labelWidth="60px" />
			</div>
			<div>
				<input class="easyui-passwordbox" prompt="请再次输入新密码" iconWidth="28"
					required="true" validType="confirmPass['#pass']"
					style="width: 100%; height: 34px;" label="密码确认" labelWidth="60px" />
			</div>
		</form>
	</div>
	<!-- 修改密码窗体按钮 -->
	<div id="changePasswordDlgButtons">
		<a href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-ok" onclick="savePassword()">保存新密码</a> <a
			href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-cancel"
			onclick="javascript:$('#changePasswordDlg').dialog('close')">放弃修改</a>
	</div>

	<script type="text/javascript">
		$(document).ready(function() {
			/* $("#menuTree").tree({
				method : "get",
				url : "users/api/" + $("#userId").val() + "/menu",
				animate : true,
				lines : true,
				onLoadSuccess : function(node, data) {
					//$("#menuTree").tree("expandAll");
				},
				onClick : function(node) {
					if (node) {
						console.log(node);
						if (node.attributes.url) {
							addTab(node.text, node.attributes.url);
						}
					}
				}
			}); */

			$("#menuCombobox").combotree({
				method : "get",
				url : "users/api/" + $("#userId").val() + "/menu",
				textField : "text",
				animate : true,
				lines : true,
				onLoadSuccess : function(node, data) {
					if(($("#menuCombobox").combotree('tree').tree('getRoots').length)==0) { //获取整个树形对象，然后获得这个树形对象的根节点的个数  
				        $.messager.alert('提示','您还没有任何权限，请与系统管理员联系！','info');
				    } else {  
					    $('#menuCombobox').combotree('tree').tree("expandAll");
				    }
				},
				onClick : function(node) {
					if (node) {
						console.log(node);
						if (node.attributes.url) {
							addTab(node.text, node.attributes.url);
						}
					}
				}
			});
		});
	</script>
</body>

</html>