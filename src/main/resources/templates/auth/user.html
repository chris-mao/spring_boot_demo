<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link th:href="@{/css/main.css}" rel="stylesheet"></link>
<link th:href="@{/jquery-easyui-1.5.3/themes/material/easyui.css}"
	rel="stylesheet"></link>
<link th:href="@{/jquery-easyui-1.5.3/themes/icon.css}" rel="stylesheet"></link>

<script th:src="@{/jquery-easyui-1.5.3/jquery.min.js}"
	type="text/javascript"></script>
<script th:src="@{/jquery-easyui-1.5.3/jquery.easyui.min.js}"
	type="text/javascript"></script>
<script th:src="@{/jquery-easyui-1.5.3/locale/easyui-lang-zh_CN.js}"
	type="text/javascript"></script>
<script th:src="@{/js/main.js}" type="text/javascript"></script>
</head>
<body>
	<!-- 数据表格 -->
	<table id="userDatagrid" class="easyui-datagrid"
		toolbar="#userDatagridToolbar">
		<thead>
			<tr>
				<th data-options="field:'ck',checkbox:true"></th>
				<th field="userName" style="width: 160px">用户名称</th>
				<th field="nickName" style="width: 260px">显示昵称</th>
				<th field="email" style="width: 200px">电子邮件</th>
				<th field="state" style="width: 80px" align="center">状态</th>
				<th field="available" style="width: 60px" align="center"
					formatter="availableFormatter">启用</th>
				<th field="createdTime" style="width: 140px"
					formatter="dateTimeFormatter">创建时间</th>
				<th field="updateTime" style="width: 140px"
					formatter="dateTimeFormatter">更新时间</th>
			</tr>
		</thead>
	</table>

	<!-- 数据表格工具栏 -->
	<div id="userDatagridToolbar" class="datagrid-toolbar">
		<shiro:hasPermission name="authUser:new">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-add" plain="true" onclick="newUser()">新增</a>
		</shiro:hasPermission>
		<shiro:hasPermission name="authUser:edit">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-edit" plain="true" onclick="editUser()">修改</a>
			<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true"
				onclick="showUserRolesDialog()">关联角色</a>
		</shiro:hasPermission>
		<shiro:hasPermission name="authUser:change-password">
			<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true"
				onclick="changeUserPsd();">修改密码</a>
		</shiro:hasPermission>
		<shiro:hasPermission name="authUser:delete">
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-remove" plain="true" onclick="deleteUser()">删除</a>
		</shiro:hasPermission>
		<input id="userSearch" prompt="请输入用户名称或昵称" class="easyui-searchbox" />
	</div>

	<!-- 新增、编辑窗体 -->
	<div id="userEditDlg" class="easyui-dialog"
		style="width: 400px; height: auto" closed="true"
		buttons="#userEditDlgButtons" data-options="modal:true">
		<form id="userEditForm" method="post">
			<div>
				<input name="userName" class="easyui-textbox" required="true"
					style="width: 100%; height: 34px;" validType="length[4,64]"
					label="用户名称" lableWidth="60px" />
			</div>
			<div>
				<input name="nickName" class="easyui-textbox" required="true"
					style="width: 100%; height: 34px;" validType="length[2,64]"
					label="显示昵称" lableWidth="60px" />
			</div>
			<div>
				<input type="email" name="email" class="easyui-textbox"
					style="width: 100%; height: 34px;" required="true"
					validType="email" label="电子邮件" lableWidth="60px" />
			</div>
			<div>
				<input class="easyui-combobox" name="state" label="状态"
					lableWidth="60px" style="width: 100%; height: 34px;"
					required="true"
					data-options="url:'/users/api/states',method:'get',valueField:'id',textField:'text',panelHeight:'auto'" />
			</div>
			<div style="text-align: right">
				<input class="easyui-switchbutton" name="available"
					data-options="onText:'启用',offText:'禁用'" checked="true" />
			</div>
		</form>
	</div>
	<!-- 新增、编辑窗体按钮 -->
	<div id="userEditDlgButtons">
		<a href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-ok" onclick="saveUser()">保存且关闭</a> <a
			href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-cancel"
			onclick="javascript:$('#userEditDlg').dialog('close')">取消</a>
	</div>

	<!-- 用户角色窗体 -->
	<div id="userRoleDlg" class="easyui-dialog" title="关联角色"
		style="width: 500px; height: 300px;" closed="true"
		buttons="#userRoleDlgButtons" data-options="modal:true">
		<table id="userRoleDatagrid" class="easyui-datagrid"
			toolbar="#userRoleDatagridToolbar">
			<thead>
				<tr>
					<th field="roleId" style="width: 160px"
						editor="{type:'combobox',options:{valueField:'roleId',textField:'roleName',method:'get',url:'/roles/api/json',required:true}}"
						formatter="roleIdDisplayFormatter">角色名称</th>
					<th field="startDate" style="width: 120px" align="center"
						formatter="dateFormatter"
						editor="{type:'datebox',options:{required:true}}">生效日期</th>
					<th field="endDate" style="width: 120px" align="center"
						formatter="dateFormatter" editor="datebox">终止日期</th>
					<th field="action" formatter="actionColumnFormatter" align="center"
						style="width: 80px;">操作</th>
				</tr>
			</thead>
		</table>
	</div>
	<!-- 用户角色工具栏 -->
	<div id="userRoleDatagridToolbar" class="datagrid-toolbar">
		<a href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-add" plain="true" onclick="appendUserRole()">添加角色</a> <a
			href="javascript:void(0)" class="easyui-linkbutton"
			data-options="iconCls:'icon-undo',plain:true" onclick="reject()">撤消所有修改</a>
	</div>
	<!-- 用户角色窗体按钮 -->
	<div id="userRoleDlgButtons">
		<a href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-ok" onclick="saveUserRoles()">保存且关闭</a> <a
			href="javascript:void(0)" class="easyui-linkbutton"
			iconCls="icon-cancel" onclick="closeUserRolesDialog()">取消</a>
	</div>

	<script th:src="@{/js/user.js}" type="text/javascript"></script>
	<script th:src="@{/js/user-role.js}" type="text/javascript"></script>
</body>
</html>
